<div class="max-w-full overflow-x-auto bg-white shadow-sm rounded-lg border border-gray-200 flex flex-col h-full">
    <div class="flex-grow">
        <table class="w-full table-auto text-sm text-left">
            <thead class="bg-gray-50 text-gray-600 font-bold border-b border-gray-200 uppercase text-xs">
                <tr>
                    <th class="py-3 px-4 min-w-[100px]">Time</th>
                    <th class="py-3 px-4 min-w-[150px]">Customer</th>
                    <th class="py-3 px-4 min-w-[150px]">Service</th>
                    <th class="py-3 px-4 min-w-[180px]">Customer Request</th>
                    <th class="py-3 px-4 min-w-[180px]">Staff Note</th>
                    <th class="py-3 px-4 min-w-[120px]">Status</th>
                    <th class="py-3 px-4 text-center">Action</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for detail in tasks %}
                {% if not detail.children %}
                <tr class="hover:bg-gray-50 transition group">
                    <td class="py-4 px-4 align-top">
                        <div class="flex flex-col">
                            <span class="font-bold text-gray-800 text-base">
                                {{ detail.start.strftime('%H:%M') }}
                            </span>
                            <span class="text-xs text-gray-400">
                                to {{ detail.end.strftime('%H:%M') }}
                            </span>
                            <span class="text-[10px] bg-gray-100 text-gray-500 rounded px-1 py-0.5 mt-1 w-fit">
                                {{ detail.booking.booking_time.strftime('%d/%m') }}
                            </span>
                        </div>
                    </td>

                    <td class="py-4 px-4 align-top">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-[var(--accent-color)]/10 text-[var(--accent-color)] flex items-center justify-center shrink-0">
                                <i class="fas fa-user text-xs"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">
                                    {{ detail.booking.customer.fullname if detail.booking.customer else 'Walk-in Guest' }}
                                </p>
                                <p class="text-xs text-gray-500 mt-0.5">
                                    <i class="fas fa-phone-alt text-[10px] mr-1"></i>
                                    {{ detail.booking.customer.phone or '---' }}
                                </p>
                            </div>
                        </div>
                    </td>

                    <td class="py-4 px-4 align-top">
                        <span class="font-bold text-[var(--accent-color)] text-base">
                            {{ detail.service.name }}
                        </span>
                    </td>

                    <td class="py-4 px-4 align-top">
                        {% if detail.booking.notes %}
                        <div class="text-xs text-orange-700 bg-orange-50 p-2 rounded border border-orange-100 italic">
                            <i class="fas fa-quote-left text-[8px] mr-1 opacity-50"></i>
                            {{ detail.booking.notes }}
                        </div>
                        {% else %}
                        <span class="text-gray-300 text-xs">-- None --</span>
                        {% endif %}
                    </td>

                    <td class="py-4 px-4 align-top">
                        <form action="/staff/update-note/{{ detail.id }}" method="POST">
                            <div class="relative">
                                <input type="text" name="staff_note"
                                       value="{{ detail.notes or '' }}"
                                       placeholder="Ghi kết quả..."
                                       class="w-full text-xs text-gray-700 border border-gray-200 rounded py-1.5 px-2 focus:border-[var(--accent-color)] focus:ring-1 focus:ring-[var(--accent-color)] transition bg-gray-50 focus:bg-white placeholder-gray-400"
                                       onchange="this.form.submit()">
                                <i class="fas fa-pen absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-gray-400 pointer-events-none"></i>
                            </div>
                        </form>
                    </td>

                    <td class="py-4 px-4 align-top">
                        <form action="/staff/update-status/{{ detail.id }}" method="POST">
                            <select name="status" onchange="this.form.submit()"
                                class="text-xs font-bold rounded-full py-1 pl-3 pr-8 border-none cursor-pointer focus:ring-2 focus:ring-offset-1 focus:ring-[var(--accent-color)] outline-none w-full
                                {% if detail.status.value == 'COMPLETED' %} bg-green-100 text-green-700
                                {% elif detail.status.value == 'PROCESSING' %} bg-blue-100 text-blue-700
                                {% elif detail.status.value == 'WAITING' %} bg-yellow-100 text-yellow-700
                                {% else %} bg-gray-100 text-gray-600 {% endif %}">
                                <option value="WAITING" {% if detail.status.value == 'WAITING' %}selected{% endif %}>Waiting</option>
                                <option value="PROCESSING" {% if detail.status.value == 'PROCESSING' %}selected{% endif %}>Processing</option>
                                <option value="COMPLETED" {% if detail.status.value == 'COMPLETED' %}selected{% endif %}>Completed</option>
                            </select>
                        </form>

                        {% if detail.status.value == 'PROCESSING' %}
                        <div class="mt-2 text-[10px] text-blue-600 animate-pulse font-medium text-center">
                            <i class="fas fa-hourglass-half mr-1"></i> Doing
                        </div>
                        {% endif %}
                    </td>

                    <td class="py-4 px-4 text-center align-top">
                        <button class="w-8 h-8 rounded hover:bg-gray-100 text-gray-400 hover:text-[var(--accent-color)] transition" title="View Customer History">
                            <i class="far fa-address-card"></i>
                        </button>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

        {% if not tasks %}
        <div class="p-12 text-center text-gray-400 flex flex-col items-center justify-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-3 text-gray-300">
                <i class="fas fa-calendar-times text-2xl"></i>
            </div>
            <p>No tasks assigned yet.</p>
        </div>
        {% endif %}
    </div>

    <div class="bg-gray-50 border-t border-gray-200 p-4 rounded-b-lg flex flex-col sm:flex-row items-center justify-between gap-4">
        <span class="text-xs text-gray-500 font-medium hidden sm:block">
            Quản lý công việc
        </span>

        <div class="inline-flex items-center shadow-sm rounded-md isolate bg-white">
            <button onclick="navigateDate(-1)"
                    class="relative inline-flex items-center justify-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-l-md hover:bg-gray-50 hover:text-[var(--accent-color)] focus:z-10 transition">
                <i class="fas fa-chevron-left mr-1"></i> Prev
            </button>

            <div class="relative -ml-px inline-flex items-center justify-center px-4 py-2 text-sm font-bold text-gray-800 bg-white border border-gray-300 focus:z-10 min-w-[140px]">
                <i class="far fa-calendar-alt mr-2 text-[var(--accent-color)]"></i>
                <span id="currentDateDisplay">Today</span>
            </div>

            <button onclick="navigateDate(1)"
                    class="relative -ml-px inline-flex items-center justify-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-r-md hover:bg-gray-50 hover:text-[var(--accent-color)] focus:z-10 transition">
                Next <i class="fas fa-chevron-right ml-1"></i>
            </button>
        </div>
    </div>
</div>